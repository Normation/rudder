angular.module("monospaced.elastic",[]).constant("msdElasticConfig",{append:""}).directive("msdElastic",["$timeout","$window","msdElasticConfig",function(e,t,n){"use strict";return{require:"ngModel",restrict:"A, C",link:function(r,i,s,o){function k(){T=u;m=getComputedStyle(u);angular.forEach(C,function(e){p+=e+":"+m.getPropertyValue(e)+";"});v.setAttribute("style",p)}function L(){var t,n,i,s,o;if(T!==u){k()}if(!N){N=true;v.value=u.value+c;v.style.overflowY=u.style.overflowY;t=u.style.height===""?"auto":parseInt(u.style.height,10);n=getComputedStyle(u).getPropertyValue("width");if(n.substr(n.length-2,2)==="px"){s=parseInt(n,10)-b.width;v.style.width=s+"px"}i=v.scrollHeight;if(i>x){i=x;o="scroll"}else if(i<S){i=S}i+=b.height;u.style.overflowY=o||"hidden";if(t!==i){u.style.height=i+"px";r.$emit("elastic:resize",a)}e(function(){N=false},1)}}function A(){N=false;L()}var u=i[0],a=i;if(u.nodeName!=="TEXTAREA"||!t.getComputedStyle){return}a.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var f=u.value;u.value="";u.value=f;var l=s.msdElastic||n.append,c=l==="\\n"?"\n":l,h=angular.element(t),p="position: absolute; top: -999px; right: auto; bottom: auto; left: 0 ;"+"overflow: hidden; -webkit-box-sizing: content-box;"+"-moz-box-sizing: content-box; box-sizing: content-box;"+"min-height: 0 !important; height: 0 !important; padding: 0;"+"word-wrap: break-word; border: 0;",d=angular.element('<textarea tabindex="-1" '+'style="'+p+'"/>').data("elastic",true),v=d[0],m=getComputedStyle(u),g=m.getPropertyValue("resize"),y=m.getPropertyValue("box-sizing")==="border-box"||m.getPropertyValue("-moz-box-sizing")==="border-box"||m.getPropertyValue("-webkit-box-sizing")==="border-box",b=!y?{width:0,height:0}:{width:parseInt(m.getPropertyValue("border-right-width"),10)+parseInt(m.getPropertyValue("padding-right"),10)+parseInt(m.getPropertyValue("padding-left"),10)+parseInt(m.getPropertyValue("border-left-width"),10),height:parseInt(m.getPropertyValue("border-top-width"),10)+parseInt(m.getPropertyValue("padding-top"),10)+parseInt(m.getPropertyValue("padding-bottom"),10)+parseInt(m.getPropertyValue("border-bottom-width"),10)},w=parseInt(m.getPropertyValue("min-height"),10),E=parseInt(m.getPropertyValue("height"),10),S=Math.max(w,E)-b.height,x=parseInt(m.getPropertyValue("max-height"),10),T,N,C=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];if(a.data("elastic")){return}x=x&&x>0?x:9e4;if(v.parentNode!==document.body){angular.element(document.body).append(v)}a.css({resize:g==="none"||g==="vertical"?"none":"horizontal"}).data("elastic",true);if("onpropertychange"in u&&"oninput"in u){u["oninput"]=u.onkeyup=L}else{u["oninput"]=L}h.bind("resize",A);r.$watch(function(){return o.$modelValue},function(e){A()});r.$on("elastic:adjust",function(){A()});e(L);r.$on("$destroy",function(){d.remove();h.unbind("resize",A)})}}}])
