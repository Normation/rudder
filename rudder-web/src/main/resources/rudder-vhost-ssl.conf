<VirtualHost *:443>

	ServerAdmin webmaster@localhost

	# Rudder webapp
	RewriteEngine on
	RewriteRule   ^/$  /rudder [R]

	ProxyPass         "/rudder" "http://localhost:8080/rudder"
	ProxyPassReverse  "/rudder" "http://localhost:8080/rudder"
	ProxyRequests     Off

	# Local reverse proxy authorization override
	# Most unix distribution deny proxy by default (ie /etc/apache2/mods-enabled/proxy.conf in Ubuntu)
	<Proxy http://localhost:8080/rudder*>
		Order deny,allow
		Allow from all
	</Proxy>

	Include /opt/rudder/etc/rudder-apache-common.conf

	# WSGI settings (for ncf builder)
	WSGIDaemonProcess ncf_api_flask_app threads=5
	WSGIScriptAlias /ncf /usr/share/ncf-api-virtualenv/ncf_api_flask_app.wsgi

	<Directory /usr/share/ncf/api>
		WSGIProcessGroup ncf_api_flask_app
		WSGIApplicationGroup %{GLOBAL}

		Order deny,allow
		Allow from all
	</Directory>

	<Directory /usr/share/ncf-api-virtualenv>
		Order deny,allow
		Allow from all
	</Directory>

	# Logs
	ErrorLog /var/log/rudder/apache2/error.log
	LogLevel warn
	CustomLog /var/log/rudder/apache2/access.log combined

	#   SSL Engine Switch:
	#   Enable/Disable SSL for this virtual host.
	SSLEngine on

	SSLCertificateFile      /opt/rudder/etc/ssl/rudder-webapp.crt
	SSLCertificateKeyFile   /opt/rudder/etc/ssl/rudder-webapp.key

	<FilesMatch "\.(cgi|shtml|phtml|php)$">
		SSLOptions +StdEnvVars
	</FilesMatch>
	<Directory /usr/lib/cgi-bin>
		SSLOptions +StdEnvVars
	</Directory>

	# MSIE 7 and newer should be able to use keepalive
	BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

</VirtualHost>
