<lift:surround with="menu/menu-administration" at="content">

<head>
  <title>Rudder - Database Management</title>
  <script type="text/javascript">
    // <![CDATA[
    var initReportDatepickler = function(selector) {
      $(selector).datepicker({ 
          dateFormat: 'yy-mm-dd' 
        , showWeek: true
        , firstDay: 1
        , changeMonth: true
        , changeYear: true
        , showButtonPanel: true
      })
    };
    // ]]>
    </script>
</head>

  <div class="portlet">
    <div class="portlet-header">Database management</div>
    <div class="portlet-content">

      <div class="intro">
        <div>Rudder stores all reports received from nodes in a database. These reports are used to calculate compliance for Rules applied to Nodes. The database can grow quite large, and keeping older reports is usually useless if you don't need to examine compliance data in the past. This page enables you to archive them to limit disk space usage growth.</div>
      </div>
      <hr class="spacer" />

      <div class="lift:administration.DatabaseManagement.display">

        <div class="inner-portlet">
          <div class="inner-portlet-header">Currently stored
            reports</div>
          <div class="inner-portlet-content">
            <table class="database-info-table">
              <tr>
                <td>Oldest report:</td>
                <td><b><span id="oldestEntry">[Here
                      comes the oldest entry]</span></b></td>
              </tr>
              <tr>
                <td>Newest report:</td>
                <td><b><span id="newestEntry">[Here
                      comes the newest entry]</span></b></td>
              </tr>
              <tr>
                <td>Total disk space used by reports:</td>
                <td><b><span id="databaseSize">[here
                      comes the database size]</span></b></td>
              </tr>
            </table>
          </div>
        </div>

        <div class="inner-portlet">
          <div class="inner-portlet-header">Archived reports</div>
          <div class="inner-portlet-content">
            <table class="database-info-table">
              <tr>
                <td>Oldest archived report:</td>
                <td><b><span id="oldestArchivedEntry">[Here
                      comes the oldest archived entry]</span></b></td>
              </tr>
              <tr>
                <td>Newest archived report:</td>
                <td><b><span id="newestArchivedEntry">[Here
                      comes the newest archived entry]</span></b></td>
              </tr>
                            <tr>
                <td>Total disk space used by archived reports:</td>
                <td><b><span id="archiveSize">[here
                      comes the database size]</span></b></td>
              </tr>
            </table>
          </div>
        </div>

        <div class="inner-portlet">
          <div class="inner-portlet-header">Clean reports</div>
            <div class="intro">
              <div>
                When reports are archived, they are removed from the active reports table.
                However, this will <b>not</b> immediately free up disk space
                (but new active reports will not use any extra space).
                See the Rudder User Documentation to recover this space.
              </div>
            </div>
          <div class="inner-portlet-content">
            <table class="database-info-table">
              <tr>
                <td colspan="2">
                <div style="margin-bottom:8px"><b>After cleaning database size on disk will not change immediately<br/>
                To free disk space, you will have to wait until next database Vacuum is proceed</b></div>
                  <form class="lift:form.ajax">
                    <div>
                      <span id="modeSelector"/> all reports older than: <input
                        id="reportFromDate" value="" />
                      <button id="archiveReports">Start cleaning
                        reports</button>
                        <span id="confirm"> </span>
                    </div>
                    <lift:Msgs>
                      <lift:error_msg class="error" />
                    </lift:Msgs>
                  </form>
                </td>
              </tr>
            </table>
          </div>
        </div>

      </div>

    </div>
    <br />
  </div>
</lift:surround>

